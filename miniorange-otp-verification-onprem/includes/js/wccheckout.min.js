jQuery(document).ready(function () {
    $mo = jQuery;
    var a = mowccheckout.paymentMethods;
    var e = mowccheckout.popupEnabled && !mowccheckout.isLoggedIn;
    $mo("#order_verify_field").hide();

    is_first_order();

    $mo('#billing_phone').on("keyup",(function(e){
        if ($mo('#billing_phone').val().length>11) {
            is_first_order();
        }
    }));

    var d = function () {
        if ($mo(".woocommerce-billing-fields").length > 0) {
            $mo("#miniorange_otp_token_submit").show();
            $mo("#miniorange_otp_token_submit").css({ "margin-right": "0" });
            if ($mo("#order_verify_field").length > 0) {
                $mo("#order_verify_field").show();
                $mo("#order_verify").focus();
            } else {
                if (e) {
                    $mo("#place_order").hide();
                }
            }
        }
    };
    var c = function () {
        if ($mo(".woocommerce-billing-fields").length > 0) {
            $mo("#miniorange_otp_token_submit").hide();
            if ($mo("#order_verify_field").length > 0) {
                $mo("#order_verify_field").hide();
                $mo("#mo_message").hide();
                $mo("#order_verify").val("");
            } else {
                $mo("#place_order").show();
            }
        }
    };
    var b = function () {
        var f = !mowccheckout.selectivePaymentEnabled;
        $mo("input[name=payment_method]").each(function () {
            var g = $mo(this).val();
            f = false;
            if (($mo(this).is(":checked") && a.hasOwnProperty(g)) || !mowccheckout.selectivePaymentEnabled) {
                f = true;
                return false;
            }
        });
        f ? d() : c();
    };
    

    function is_first_order()
    {
        var mophone=$mo('#billing_phone').val();
        $mo.ajax(
        {
            url: mowccheckout.siteURL,
            type: "POST",
            data:{
                phone: mophone,
                action:"is_first_order",
            },
            crossDomain:!0,dataType:"json",
            success:function(o)
            {
                if (o.message == "is_first_order_false") 
                {
                    $mo("#place_order").show();
                    $mo("#miniorange_otp_token_submit").hide();
                }
                else
                {
                    $mo("#place_order").hide();
                    $mo("#miniorange_otp_token_submit").show();
                    setTimeout(function () {
                        b();
                        $mo(".woocommerce-checkout-review-order").click(function () {
                            b();
                        });
                    }, 200);
                }
            },
            error:function(o){

            }
        });
    }

});